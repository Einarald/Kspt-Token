<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KSPT Token</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0b0b;
  font-family:Arial,sans-serif;
  color:#fff;
  -webkit-tap-highlight-color: transparent; /* Убирает синее выделение на мобильных */
}

.app{
  max-width:420px;
  margin:0 auto;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  padding:16px;
}

/* ===== COMMON ===== */
.screen{display:none}
.screen.active{display:block}

.top-bar{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:16px;
}
.top-bar img{
  width:32px;
  height:32px;
}
.top-bar span{
  font-size:16px;
  opacity:.85;
}

.balance-main{
  font-size:22px;
  margin:10px 0 30px;
  text-align:center;
}

/* ===== COIN ===== */
.coin{
  width:220px;
  height:220px;
  margin:0 auto 40px;
  display:block;
  transition:transform .08s ease; /* Плавность для JS анимации */
  cursor: pointer;
}

/* Класс для JS-анимации нажатия */
.coin.anim {
  transform: scale(0.92);
}

/* ===== BOTTOM BUTTONS ===== */
.bottom-bar{
  margin-top:auto;
  display:flex;
  justify-content:space-between;
  gap:20px;
}

.long-btn{
  flex:1;
  height:70px;
  background:#1a1a1a;
  border-radius:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor: pointer;
}
.long-btn img{
  height:42px;
  width:auto;
}

/* ===== CARDS ===== */
.card{
  background:#161616;
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}

.card-title{font-weight:bold;margin-bottom:6px}
.card-sub{font-size:13px;opacity:.6;margin-bottom:8px}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#262626;
  color:#fff;
  font-size:15px;
  cursor: pointer;
}

button.active{background:#2e7d32}
button.owned{background:#333;opacity:.6}

.back{
  margin-top:20px;
  opacity:.6;
  background:none;
}

/* ===== BET ===== */
.input-group {
  display: flex;
  gap: 10px;
  margin-bottom: 8px;
}

input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:16px;
  background: #fff;
  color: #000;
}

.max-btn {
  width: auto;
  padding: 0 20px;
  background: #ff9800; /* Выделим кнопку MAX цветом */
  font-weight: bold;
}

.confirm{
  background:#2e7d32;
  margin-top:8px;
}
.cancel{
  background:#444;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="app">

<div id="main" class="screen active">
  <div class="balance-main" id="balanceMain">0.00 KSPT</div>
  <img id="coin" class="coin" src="kspt.png" alt="Coin">
  <div class="bottom-bar">
    <div class="long-btn" onclick="openScreen('skins')">
      <img src="m.png" alt="Skins">
    </div>
    <div class="long-btn" onclick="openScreen('tech')">
      <img src="t.png" alt="Tech">
    </div>
  </div>
</div>

<div id="skins" class="screen">
  <div class="top-bar">
    <img src="kspt.png">
    <span id="balanceSkins"></span>
  </div>

  <div class="card">
    <div class="card-title">Default Coin</div>
    <div class="card-sub">Standard</div>
    <button id="skin-default" onclick="buySkin('default',0)"></button>
  </div>

  <div class="card">
    <div class="card-title">WHAT IS KSPT</div>
    <div class="card-sub">Price: 1 KSPT</div>
    <button id="skin-what" onclick="buySkin('what',1)"></button>
  </div>

  <div class="card">
    <div class="card-title">KSPT Burger Edition</div>
    <div class="card-sub">Price: 10 KSPT</div>
    <button id="skin-burger" onclick="buySkin('burger',10)"></button>
  </div>

  <button class="back" onclick="openScreen('main')">Back</button>
</div>

<div id="tech" class="screen">
  <div class="top-bar">
    <img src="kspt.png">
    <span id="balanceTech"></span>
  </div>

  <div class="card">
    <div class="card-title">Permanent x2</div>
    <div class="card-sub">Price: 5 KSPT</div>
    <button onclick="buyX2()">Buy</button>
  </div>

  <div class="card">
    <div class="card-title">Bet</div>
    <div class="input-group">
      <input id="betAmount" type="number" placeholder="1–30">
      <button class="max-btn" onclick="setMaxBet()">MAX</button>
    </div>
    
    <button onclick="prepareBet(1.5,30)">x1.5 (30%)</button>
    <button onclick="prepareBet(3,17)">x3 (17%)</button>
    <button onclick="prepareBet(5,8)">x5 (8%)</button>
    <button onclick="prepareBet(10,3)">x10 (3%)</button>
  </div>

  <div id="betConfirm" class="card" style="display:none">
    <div id="betText"></div>
    <button class="confirm" onclick="confirmBet()">Confirm</button>
    <button class="cancel" onclick="cancelBet()">Cancel</button>
  </div>

  <button class="back" onclick="openScreen('main')">Back</button>
</div>

</div>

<script>
if (window.Telegram?.WebApp){
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
}

// Данные
let d=JSON.parse(localStorage.getItem("kspt"))||{
 tokens:0,skin:"default",skins:{},x2:false
};

let pendingBet=null;

const save=()=>localStorage.setItem("kspt",JSON.stringify(d));

function ui(){
 balanceMain.innerText=d.tokens.toFixed(2)+" KSPT";
 balanceSkins.innerText="Balance: "+d.tokens.toFixed(2)+" KSPT";
 balanceTech.innerText="Balance: "+d.tokens.toFixed(2)+" KSPT";

 // Логика картинки
 coin.src = d.skin === "what" ? "what.png" : d.skin === "burger" ? "burger.png" : "kspt.png";

 // Логика кнопок скинов (добавлен default)
 ["default", "what","burger"].forEach(s=>{
  let b=document.getElementById("skin-"+s);
  if (!b) return; // Защита если элемента нет

  if(d.skin===s){
    b.textContent="ACTIVE";
    b.className="active";
  }
  else if(s === "default" || d.skins[s]){
    b.textContent="OWNED"; // Для дефолтного всегда OWNED, если не активен
    b.className="owned";
  }
  else{
    b.textContent="BUY";
    b.className="";
  }
 });
}
ui();

function openScreen(id){
 document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 ui();
}

// Исправлена анимация: используем класс вместо CSS :active
coin.onclick=()=>{
 let m=d.x2?2:1;
 d.tokens+=0.01*m;
 
 // Анимация
 coin.classList.add('anim');
 setTimeout(() => {
   coin.classList.remove('anim');
 }, 80); // Быстрое удаление класса для эффекта клика

 save();ui();
};

function buySkin(s,c){
 if(s === "default") {
    d.skin = "default"; // Всегда можно выбрать дефолт
 }
 else if(d.skins[s]) {
    d.skin=s;
 }
 else if(d.tokens>=c){
  d.tokens-=c;
  d.skins[s]=1;
  d.skin=s;
 }
 save();ui();
}

function buyX2(){
 if(!d.x2 && d.tokens>=5){
  d.tokens-=5;
  d.x2=true;
  save();ui();
 }
}

// Новая функция для кнопки MAX
function setMaxBet() {
  let max = 30;
  if (d.tokens < 30) {
    max = Math.floor(d.tokens); // Округляем вниз до целого
  }
  if (max < 1) max = 1; // Минимум 1
  betAmount.value = max;
}

function prepareBet(mult,ch){
 let a=+betAmount.value;
 if(a<1||a>30||a>d.tokens)return;
 pendingBet={a,mult,ch};
 betText.innerText=`Bet ${a} KSPT with x${mult}?`;
 betConfirm.style.display="block";
}

function cancelBet(){
 pendingBet=null;
 betConfirm.style.display="none";
}

function confirmBet(){
 let {a,mult,ch}=pendingBet;
 betConfirm.style.display="none";
 pendingBet=null;
 d.tokens-=a;
 if(Math.random()*100<ch)d.tokens+=a*mult;
 save();ui();
}
</script>
</body>
</html>
